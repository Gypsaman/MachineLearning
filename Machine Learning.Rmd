---
title: "Machine Learning Course Project"
author: "Cesar Garcia"
date: "May 11, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(caret)
library(randomForest)
```

##Data

The training data for this project are available here: [Traning Data](https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv)

The test data are available here: [Test Data](https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv)

Data is courtesy of

Velloso, E.; Bulling, A.; Gellersen, H.; Ugulino, W.; Fuks, H. Qualitative Activity Recognition of Weight Lifting Exercises. Proceedings of 4th International Conference in Cooperation with SIGCHI (Augmented Human '13) . Stuttgart, Germany: ACM

## Load Data and Clean Predictors

Some of the data columns contain a lot of NAs and near zero values.  These columns will be removed from the dataset used for training, hence will not be used in the predictions.
```{r}

training <- read.csv("pml-training.csv")
testing <- read.csv("pml-testing.csv")

train <- training[, names(training)[!(nzv(training, saveMetrics = T)[, 4])]]
train <- train[, names(train)[sapply(train, function (x) ! (any(is.na(x) | x == "")))]]
train <- train[,-1]
test <- testing[, names(testing)[!(nzv(testing, saveMetrics = T)[, 4])]]
test <- test[, names(test)[sapply(test, function (x) ! (any(is.na(x) | x == "")))]]
testing <- read.csv("pml-testing.csv", na.strings = c("NA","#DIV/0!",""))
```

## Separate data for Training and Cross Validation

```{r}
inTrain <- createDataPartition(train$classe,p=0.6,list=FALSE)
subTraining <- train[inTrain,]
SubValidation <- train[-inTrain,]
```

##  Create a Random Forest Model

The different classe levels are displayed to ensure model address all classe.  The model selecte will be a random forest. The data will be saved data to reduce in reprocessing times when project is recalculated.

```{r}
table(subTraining$classe)

# Check if model file exists
model <- "modelFit.RData"
if (!file.exists(model)) {

    date()
    fit <- train(classe ~ ., method = "rf", data = subTraining)
    date()
    save(fit, file = "modelFit.RData")

} else {
    # Good model exists from previous run, load it and use it.  
    load(file = "modelFit.RData", verbose = TRUE)
}
```

## Accuracy and Sample Error

```{r}
predTrain <- predict(fit, subTraining)
confusionMatrix(predTrain,subTraining$classe)
```

The model has a an accuracy of 0.9997 within the training data.  The cross validation data set will be processed through the same model to validate the model before we run the test data.

```{r}
predValidation <- predict(fit,SubValidation)
confusionMatrix(predValidation,SubValidation$classe)
```

The model has a 0.9997 accuracy with the validation data and an out of sample error of 0.0003.  This provides us a reasonable assurance that the model would be a good predictor of new data.

The important predictors in the model are:
```{r}
varImp(fit)
```

```{r}
fit$finalModel
```

## Predict Test Data With Model

The out-of-bag (OOB) error rate is 0.13% which provides a highlevel of acuracy.  We will use this model to predict classe in the testdata

```{r}
predTest <- predict(fit,testing)
predTest
```

The predictions generated by the model were 100% accurate.  The quiz resulted in 100% score.

